<div class="dashboard-container">
  <!-- Sidebar -->
  <app-sidebar></app-sidebar>

  <!-- Loading Overlay -->
  <app-loading-spinner *ngIf="isLoading" [overlay]="true" message="Carregando dados..."></app-loading-spinner>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="dashboard-header">
      <div class="header-title">
        <i class="fa-solid fa-chart-line header-icon"></i>
        <h1>Visão Geral</h1>
      </div>
    </header>

    <!-- Development Message Alert -->
    <div class="development-alert" *ngIf="developmentMessage">
      <div class="alert-icon">
        <i class="fa-solid fa-code"></i>
      </div>
      <div class="alert-content">
        <strong>Funcionalidade em Desenvolvimento</strong>
        <p>{{ developmentMessage }}</p>
      </div>
      <button class="alert-close" (click)="developmentMessage = ''">
        <i class="fa-solid fa-times"></i>
      </button>
    </div>

    <!-- Error State -->
    <app-error-message 
      *ngIf="hasError && !isLoading"
      [title]="'Erro ao carregar dashboard'"
      [message]="errorMessage || 'Não foi possível carregar os dados do dashboard. Tente novamente.'"
      (retry)="retryLoad()">
    </app-error-message>

    <!-- Content -->
    <ng-container *ngIf="!isLoading && !hasError">
      <!-- Cards de Resumo -->
    <section class="summary-cards">
      <div class="card card-primary">
        <div class="card-icon">
          <i class="fa-solid fa-wallet"></i>
        </div>
        <div class="card-content">
          <h3>Saldo Atual</h3>
          <p class="card-value" [class.negative]="balance < 0">{{ formatCurrency(balance) }}</p>
        </div>
      </div>

      <div class="card card-income">
        <div class="card-icon">
          <i class="fa-solid fa-arrow-trend-up"></i>
        </div>
        <div class="card-content">
          <h3>Recebido</h3>
          <p class="card-value">{{ formatCurrency(received) }}</p>
        </div>
      </div>

      <div class="card card-expense">
        <div class="card-icon">
          <i class="fa-solid fa-arrow-trend-down"></i>
        </div>
        <div class="card-content">
          <h3>Gasto</h3>
          <p class="card-value">{{ formatCurrency(spent) }}</p>
        </div>
      </div>

      <div class="card card-investment">
        <div class="card-icon">
          <i class="fa-solid fa-chart-pie"></i>
        </div>
        <div class="card-content">
          <h3>Investido</h3>
          <p class="card-value">{{ formatCurrency(invested) }}</p>
        </div>
      </div>
    </section>

    <!-- Gráficos -->
    <section class="charts-section">
      <div class="chart-card chart-line">
        <div class="chart-header">
          <div class="chart-legend">
            <span class="legend-item">
              <span class="legend-dot" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);"></span>
              Despesas
            </span>
            <span class="legend-item">
              <span class="legend-dot" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);"></span>
              Receitas
            </span>
          </div>
        </div>
        <div class="chart-content">
          <div class="chart-placeholder">
            <svg viewBox="0 0 400 200" class="line-chart">
              <!-- Grid lines -->
              <line x1="0" y1="50" x2="400" y2="50" stroke="#e2e8f0" stroke-width="1" stroke-dasharray="4"/>
              <line x1="0" y1="100" x2="400" y2="100" stroke="#e2e8f0" stroke-width="1" stroke-dasharray="4"/>
              <line x1="0" y1="150" x2="400" y2="150" stroke="#e2e8f0" stroke-width="1" stroke-dasharray="4"/>
              <!-- Área de receitas -->
              <defs>
                <linearGradient id="areaGradientGreen" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" style="stop-color:#10b981;stop-opacity:0.3"/>
                  <stop offset="100%" style="stop-color:#10b981;stop-opacity:0"/>
                </linearGradient>
                <linearGradient id="areaGradientRed" x1="0%" y1="0%" x2="0%" y2="100%">
                  <stop offset="0%" style="stop-color:#ef4444;stop-opacity:0.3"/>
                  <stop offset="100%" style="stop-color:#ef4444;stop-opacity:0"/>
                </linearGradient>
              </defs>
              <!-- Linhas do gráfico -->
              <polyline
                points="0,150 50,120 100,130 150,100 200,110 250,80 300,90 350,60 400,70"
                fill="none"
                stroke="#ef4444"
                stroke-width="3"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <polyline
                points="0,180 50,160 100,150 150,140 200,120 250,110 300,100 350,80 400,70"
                fill="none"
                stroke="#10b981"
                stroke-width="3"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <!-- Eixos -->
              <line x1="0" y1="0" x2="0" y2="200" stroke="#B3B3B3" stroke-width="1" opacity="0.3"/>
              <line x1="0" y1="200" x2="400" y2="200" stroke="#B3B3B3" stroke-width="1" opacity="0.3"/>
            </svg>
          </div>
        </div>
      </div>

      <div class="chart-card chart-pie">
        <h3>Distribuição de Gastos</h3>
        <div class="pie-chart-wrapper">
          <div class="pie-chart">
            <svg viewBox="0 0 200 200">
              <defs>
                <linearGradient id="pieGrad1" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#0066cc"/>
                  <stop offset="100%" style="stop-color:#0052a3"/>
                </linearGradient>
                <linearGradient id="pieGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#10b981"/>
                  <stop offset="100%" style="stop-color:#059669"/>
                </linearGradient>
                <linearGradient id="pieGrad3" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#6366f1"/>
                  <stop offset="100%" style="stop-color:#4f46e5"/>
                </linearGradient>
              </defs>
              <circle cx="100" cy="100" r="80" fill="url(#pieGrad1)" />
              <path d="M 100 100 L 100 20 A 80 80 0 0 1 170 130 Z" fill="url(#pieGrad2)" />
              <path d="M 100 100 L 170 130 A 80 80 0 0 1 100 180 Z" fill="url(#pieGrad3)" />
            </svg>
          </div>
          <div class="pie-legend">
            <div class="legend-item" *ngFor="let category of expenseCategories">
              <span class="legend-dot" [style.background]="category.color"></span>
              <span class="legend-text">{{ category.name }}</span>
            </div>
          </div>
        </div>
      </div>
    </section>

      <!-- Movimentações Financeiras -->
      <section class="transactions-section">
        <div class="section-header">
          <h2>Movimentações Recentes</h2>
          <button class="btn-add" (click)="addTransaction()"><i class="fa-solid fa-plus"></i> Nova Transação</button>
        </div>

        <!-- Empty State -->
        <app-empty-state 
          *ngIf="transactions.length === 0"
          [icon]="'fa-solid fa-money-bill-transfer'"
          [title]="'Nenhuma movimentação'"
          [message]="'Você ainda não possui movimentações financeiras. Comece adicionando sua primeira transação.'"
          [actionLabel]="'Adicionar Movimentação'">
        </app-empty-state>

        <!-- Transactions Table -->
        <div class="transactions-table" *ngIf="transactions.length > 0">
          <table>
            <thead>
              <tr>
                <th>Descrição</th>
                <th>Categoria</th>
                <th>Data</th>
                <th>Valor</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let transaction of transactions">
                <td class="transaction-desc">{{ transaction.description || 'Sem descrição' }}</td>
                <td><span class="transaction-category">{{ transaction.category || 'Outros' }}</span></td>
                <td class="transaction-date">{{ transaction.date || (transaction.transaction_date | date: 'dd/MM/yyyy') }}</td>
                <td class="transaction-amount" [class.income]="transaction.type === 'income'" [class.expense]="transaction.type === 'expense'">
                  {{ transaction.type === 'income' ? '+' : '-' }} {{ formatCurrency(transaction.amount) }}
                </td>
                <td class="transaction-actions">
                  <button class="action-icon" [class.income]="transaction.type === 'income'" [class.expense]="transaction.type === 'expense'">
                    <i class="fa-solid" [class.fa-arrow-up]="transaction.type === 'income'" [class.fa-arrow-down]="transaction.type === 'expense'"></i>
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </ng-container>
  </main>

  <!-- Transaction Modal -->
  <app-transaction-modal 
    (onSuccess)="onTransactionSuccess()">
  </app-transaction-modal>
</div>
