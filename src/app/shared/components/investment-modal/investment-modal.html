<dialog #modal class="investment-modal-dialog">
    <div class="modal-content">
        <!-- Cabeçalho -->
        <div class="modal-header">
            <h2 class="modal-title">
                {{ isEditing ? 'Editar Investimento' : 'Novo Investimento' }}
            </h2>
            <button type="button" class="btn-close" (click)="onCancelClick()" aria-label="Fechar">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <!-- Corpo -->
        <form [formGroup]="form" (ngSubmit)="onSubmit()" class="modal-body">
            <!-- Tipo de Investimento -->
            <div class="form-group" *ngIf="!isEditing">
                <label for="investmentType">Tipo de Investimento</label>
                <div class="investment-type-selector">
                    <button
                        type="button"
                        class="type-btn"
                        [class.active]="investmentType === 'rendafixa'"
                        (click)="investmentType = 'rendafixa'; updateValidators()"
                    >
                        <i class="fas fa-piggy-bank"></i>
                        <span>Renda Fixa</span>
                    </button>
                    <button
                        type="button"
                        class="type-btn"
                        [class.active]="investmentType === 'rendavariavel'"
                        (click)="investmentType = 'rendavariavel'; updateValidators()"
                    >
                        <i class="fas fa-chart-line"></i>
                        <span>Renda Variável</span>
                    </button>
                </div>
            </div>

            <!-- Campos Comuns -->
            <div class="form-group">
                <label for="amount">Valor do Investimento *</label>
                <div class="input-group">
                    <span class="input-addon">R$</span>
                    <input
                        type="number"
                        id="amount"
                        formControlName="amount"
                        placeholder="0,00"
                        step="0.01"
                        min="0"
                        class="form-input"
                        [class.is-invalid]="isFieldInvalid('amount')"
                    />
                </div>
                <span class="error-message" *ngIf="isFieldInvalid('amount')">
                    {{ getErrorMessage('amount') }}
                </span>
            </div>

            <!-- Renda Fixa -->
            <ng-container *ngIf="investmentType === 'rendafixa'">
                <div class="form-group">
                    <label for="name">Nome ou Instituição *</label>
                    <input
                        type="text"
                        id="name"
                        formControlName="name"
                        placeholder="Ex: CDB Banco XYZ, Tesouro Direto"
                        class="form-input"
                        [class.is-invalid]="isFieldInvalid('name')"
                    />
                    <span class="error-message" *ngIf="isFieldInvalid('name')">
                        {{ getErrorMessage('name') }}
                    </span>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="yield_rate">Taxa de Rendimento Anual (%) *</label>
                        <input
                            type="number"
                            id="yield_rate"
                            formControlName="yield_rate"
                            placeholder="Ex: 9.5"
                            step="0.01"
                            min="0"
                            class="form-input"
                            [class.is-invalid]="isFieldInvalid('yield_rate')"
                        />
                        <span class="error-message" *ngIf="isFieldInvalid('yield_rate')">
                            {{ getErrorMessage('yield_rate') }}
                        </span>
                    </div>

                    <div class="form-group">
                        <label for="tax_exempt" class="checkbox-label">
                            <input
                                type="checkbox"
                                id="tax_exempt"
                                formControlName="tax_exempt"
                                class="form-checkbox"
                            />
                            <span>Isento de Impostos</span>
                        </label>
                    </div>
                </div>
            </ng-container>

            <!-- Renda Variável -->
            <ng-container *ngIf="investmentType === 'rendavariavel'">
                <div class="form-group">
                    <label for="stock_uuid">Ticker/UUID da Ação *</label>
                    <input
                        type="text"
                        id="stock_uuid"
                        formControlName="stock_uuid"
                        placeholder="Ex: PETR4, VALE3"
                        class="form-input"
                        [class.is-invalid]="isFieldInvalid('stock_uuid')"
                    />
                    <span class="error-message" *ngIf="isFieldInvalid('stock_uuid')">
                        {{ getErrorMessage('stock_uuid') }}
                    </span>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="quantity">Quantidade de Ações *</label>
                        <input
                            type="number"
                            id="quantity"
                            formControlName="quantity"
                            placeholder="Ex: 10"
                            step="1"
                            min="1"
                            class="form-input"
                            [class.is-invalid]="isFieldInvalid('quantity')"
                        />
                        <span class="error-message" *ngIf="isFieldInvalid('quantity')">
                            {{ getErrorMessage('quantity') }}
                        </span>
                    </div>

                    <div class="form-group">
                        <label for="unit_price">Preço Unitário *</label>
                        <div class="input-group">
                            <span class="input-addon">R$</span>
                            <input
                                type="number"
                                id="unit_price"
                                formControlName="unit_price"
                                placeholder="0,00"
                                step="0.01"
                                min="0"
                                class="form-input"
                                [class.is-invalid]="isFieldInvalid('unit_price')"
                            />
                        </div>
                        <span class="error-message" *ngIf="isFieldInvalid('unit_price')">
                            {{ getErrorMessage('unit_price') }}
                        </span>
                    </div>
                </div>
            </ng-container>

            <!-- Campos Adicionais -->
            <div class="form-group">
                <label for="description">Descrição</label>
                <textarea
                    id="description"
                    formControlName="description"
                    placeholder="Notas adicionais sobre este investimento"
                    class="form-input"
                    rows="3"
                ></textarea>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="purchase_date">Data de Compra *</label>
                    <input
                        type="date"
                        id="purchase_date"
                        formControlName="purchase_date"
                        class="form-input"
                        [class.is-invalid]="isFieldInvalid('purchase_date')"
                    />
                    <span class="error-message" *ngIf="isFieldInvalid('purchase_date')">
                        {{ getErrorMessage('purchase_date') }}
                    </span>
                </div>

                <div class="form-group">
                    <label for="sale_date">Data de Venda</label>
                    <input
                        type="date"
                        id="sale_date"
                        formControlName="sale_date"
                        class="form-input"
                    />
                </div>
            </div>
        </form>

        <!-- Rodapé -->
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="onCancelClick()" :disabled="isLoading">
                Cancelar
            </button>
            <button
                type="submit"
                class="btn btn-primary"
                (click)="onSubmit()"
                [disabled]="!form.valid || isLoading"
            >
                <i class="fas fa-spinner fa-spin" *ngIf="isLoading"></i>
                {{ isLoading ? 'Salvando...' : isEditing ? 'Atualizar' : 'Criar' }}
            </button>
        </div>
    </div>
</dialog>
